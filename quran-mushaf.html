<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„Ù…ØµØ­Ù Ø§Ù„ÙƒØ±ÙŠÙ…</title>
<link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&family=Amiri:wght@400;700&family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --cream: #fdf6e3;
  --cream2: #f5ead0;
  --brown: #5c3d1e;
  --brown2: #8b5e2e;
  --gold: #c8972a;
  --gold2: #e8b84b;
  --shadow: rgba(92,61,30,0.18);
  --text: #2c1a0e;
  --muted: #9e7a50;
  --bg: #2a1f14;
  --bg2: #1a1208;
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: 'Cairo', sans-serif;
  background: var(--bg);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* ===== TOP BAR ===== */
.topbar {
  width: 100%;
  background: linear-gradient(135deg, var(--bg2), var(--bg));
  border-bottom: 2px solid var(--gold);
  padding: 10px 24px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  flex-wrap: wrap;
  position: sticky;
  top: 0;
  z-index: 100;
}
.logo {
  font-family: 'Amiri', serif;
  font-size: 22px;
  color: var(--gold2);
  letter-spacing: 1px;
}
.logo span { font-size: 13px; color: var(--muted); display: block; font-family: 'Cairo', sans-serif; }

.nav-group {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.page-nav {
  display: flex;
  align-items: center;
  gap: 6px;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(200,151,42,0.3);
  border-radius: 10px;
  padding: 6px 10px;
}
.nav-btn {
  background: none;
  border: none;
  color: var(--gold2);
  font-size: 18px;
  cursor: pointer;
  padding: 2px 6px;
  border-radius: 6px;
  transition: background 0.2s;
}
.nav-btn:hover { background: rgba(200,151,42,0.2); }
.nav-btn:disabled { opacity: 0.3; cursor: default; }

.page-input-wrap {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--gold2);
  font-size: 13px;
  font-weight: 600;
}
.page-input-wrap input {
  width: 52px;
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(200,151,42,0.4);
  border-radius: 6px;
  color: var(--gold2);
  font-family: 'Cairo', sans-serif;
  font-size: 14px;
  font-weight: 700;
  text-align: center;
  padding: 3px 4px;
  outline: none;
}

.sura-select {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(200,151,42,0.3);
  border-radius: 8px;
  color: var(--gold2);
  font-family: 'Cairo', sans-serif;
  font-size: 12px;
  padding: 7px 10px;
  outline: none;
  cursor: pointer;
  max-width: 160px;
}
.sura-select option { background: #1a1208; color: #f5e6c0; }

.topbar-btn {
  display: flex; align-items: center; gap: 5px;
  background: rgba(200,151,42,0.12);
  border: 1px solid rgba(200,151,42,0.35);
  border-radius: 8px;
  color: var(--gold2);
  font-family: 'Cairo', sans-serif;
  font-size: 12px;
  font-weight: 600;
  padding: 7px 12px;
  cursor: pointer;
  transition: all 0.2s;
}
.topbar-btn:hover { background: rgba(200,151,42,0.25); }
.topbar-btn label { cursor: pointer; display: flex; align-items: center; gap: 5px; }
.topbar-btn input[type=file] { display: none; }

/* ===== MUSHAF WRAPPER ===== */
.mushaf-wrapper {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 24px 16px;
  width: 100%;
}

/* ===== MUSHAF PAGE ===== */
.mushaf-page {
  background: var(--cream);
  width: min(680px, 100%);
  min-height: 900px;
  border-radius: 4px;
  box-shadow:
    0 2px 0 var(--brown2),
    4px 4px 0 rgba(92,61,30,0.4),
    8px 8px 0 rgba(92,61,30,0.2),
    0 20px 60px rgba(0,0,0,0.7);
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  transition: opacity 0.3s;
}
.mushaf-page.loading { opacity: 0.4; }

/* Page border decoration */
.mushaf-page::before {
  content: '';
  position: absolute;
  inset: 10px;
  border: 1.5px solid var(--brown2);
  pointer-events: none;
  z-index: 1;
}
.mushaf-page::after {
  content: '';
  position: absolute;
  inset: 14px;
  border: 0.5px solid rgba(139,94,46,0.3);
  pointer-events: none;
  z-index: 1;
}

/* Page header */
.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 18px 28px 10px;
  border-bottom: 1px solid rgba(139,94,46,0.2);
  position: relative;
  z-index: 2;
}
.page-meta {
  font-size: 11px;
  color: var(--brown2);
  font-family: 'Cairo', sans-serif;
  font-weight: 600;
}
.page-num-display {
  font-family: 'Amiri', serif;
  font-size: 14px;
  color: var(--brown);
  font-weight: 700;
}
.juz-info {
  font-size: 11px;
  color: var(--brown2);
  font-family: 'Cairo', sans-serif;
  font-weight: 600;
}

/* Surah name banner */
.sura-banner {
  text-align: center;
  padding: 12px 0 6px;
  position: relative;
  z-index: 2;
}
.sura-banner-name {
  font-family: 'Amiri', serif;
  font-size: 26px;
  color: var(--brown);
  display: inline-block;
  padding: 4px 30px;
  position: relative;
}
.sura-banner-name::before,
.sura-banner-name::after {
  content: 'â§';
  color: var(--gold);
  margin: 0 10px;
  font-size: 20px;
}
.sura-banner-sub {
  font-size: 11px;
  color: var(--muted);
  font-family: 'Cairo', sans-serif;
  margin-top: 2px;
}

/* Basmala */
.basmala-line {
  text-align: center;
  font-family: 'Amiri Quran', 'Amiri', serif;
  font-size: 26px;
  color: var(--brown);
  padding: 8px 28px 4px;
  position: relative;
  z-index: 2;
}

/* Divider */
.ornament-divider {
  text-align: center;
  color: var(--gold);
  font-size: 18px;
  padding: 4px 0;
  position: relative;
  z-index: 2;
}

/* Ayah text area */
.ayat-text-area {
  flex: 1;
  padding: 14px 28px 20px;
  position: relative;
  z-index: 2;
  line-height: 2.4;
  text-align: justify;
  font-family: 'Amiri Quran', 'Amiri', serif;
  font-size: 22px;
  color: var(--text);
  word-spacing: 4px;
}

.ayah-inline {
  display: inline;
  cursor: pointer;
  transition: background 0.15s;
  border-radius: 3px;
  padding: 0 2px;
}
.ayah-inline:hover { background: rgba(200,151,42,0.18); }
.ayah-inline.playing { background: rgba(200,151,42,0.3); color: var(--brown); }

.ayah-number-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 40 40'%3E%3Cpath d='M20 2 L38 20 L20 38 L2 20 Z' fill='none' stroke='%23c8972a' stroke-width='1.5'/%3E%3C/svg%3E") center/contain no-repeat;
  font-family: 'Amiri', serif;
  font-size: 11px;
  color: var(--gold);
  vertical-align: middle;
  margin: 0 3px;
  cursor: pointer;
  transition: filter 0.2s;
  flex-shrink: 0;
}
.ayah-number-badge:hover { filter: brightness(1.4); }
.ayah-number-badge.playing { filter: brightness(1.5); }

/* Page footer */
.page-footer {
  border-top: 1px solid rgba(139,94,46,0.2);
  padding: 8px 28px 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: relative;
  z-index: 2;
}
.footer-dots {
  color: var(--gold);
  letter-spacing: 4px;
  font-size: 10px;
}
.page-footer-num {
  font-family: 'Amiri', serif;
  font-size: 15px;
  color: var(--brown2);
}

/* Loading skeleton */
.skeleton-line {
  height: 22px;
  background: linear-gradient(90deg, rgba(139,94,46,0.12) 25%, rgba(139,94,46,0.2) 50%, rgba(139,94,46,0.12) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.4s infinite;
  border-radius: 4px;
  margin-bottom: 18px;
}
@keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }

/* ===== PLAYER BAR ===== */
.player-bar {
  width: 100%;
  background: linear-gradient(135deg, var(--bg2), var(--bg));
  border-top: 2px solid var(--gold);
  padding: 10px 20px;
  display: none;
  align-items: center;
  gap: 14px;
  position: sticky;
  bottom: 0;
  z-index: 100;
}
.player-bar.visible { display: flex; }
.player-info { flex: 1; min-width: 0; }
.player-title { font-size: 13px; color: var(--gold2); font-weight: 700; }
.player-sub { font-size: 11px; color: var(--muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.player-controls { display: flex; align-items: center; gap: 10px; }
.pc-btn { background: none; border: none; color: var(--gold2); font-size: 20px; cursor: pointer; transition: transform 0.15s, color 0.15s; }
.pc-btn:hover { color: #fff; transform: scale(1.15); }
.pc-btn.main-btn { font-size: 26px; }
.player-progress { flex: 1; min-width: 80px; height: 4px; background: rgba(200,151,42,0.2); border-radius: 2px; cursor: pointer; }
.player-fill { height: 100%; background: linear-gradient(90deg, var(--gold), var(--gold2)); border-radius: 2px; width: 0%; transition: width 0.15s; }

/* ===== AUDIO UPLOAD MODAL ===== */
.upload-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  z-index: 200;
  align-items: center;
  justify-content: center;
}
.upload-modal.open { display: flex; }
.modal-box {
  background: #1e1408;
  border: 1px solid var(--gold);
  border-radius: 16px;
  padding: 28px;
  width: min(480px, 90vw);
  box-shadow: 0 20px 60px rgba(0,0,0,0.8);
}
.modal-title { font-size: 18px; font-weight: 700; color: var(--gold2); margin-bottom: 8px; }
.modal-desc { font-size: 13px; color: var(--muted); line-height: 1.8; margin-bottom: 20px; }
.modal-drop {
  border: 2px dashed rgba(200,151,42,0.4);
  border-radius: 12px;
  padding: 30px;
  text-align: center;
  color: var(--muted);
  font-size: 13px;
  cursor: pointer;
  transition: all 0.2s;
  margin-bottom: 16px;
}
.modal-drop:hover { border-color: var(--gold); color: var(--gold2); background: rgba(200,151,42,0.05); }
.modal-drop input { display: none; }
.modal-drop .drop-icon { font-size: 36px; margin-bottom: 8px; }
.modal-drop .drop-text { font-size: 13px; }
.modal-btns { display: flex; gap: 10px; justify-content: flex-end; }
.modal-btn { padding: 9px 20px; border-radius: 8px; border: none; cursor: pointer; font-family: 'Cairo', sans-serif; font-size: 13px; font-weight: 600; transition: all 0.2s; }
.modal-btn-cancel { background: rgba(255,255,255,0.06); color: var(--muted); border: 1px solid rgba(255,255,255,0.1); }
.modal-btn-confirm { background: linear-gradient(135deg, #8a6d1e, var(--gold)); color: #0d0900; }
.uploaded-count { font-size: 12px; color: var(--gold2); margin-bottom: 12px; text-align: center; min-height: 18px; }

/* Toast */
.toast {
  position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
  background: #1e1408; border: 1px solid var(--gold);
  color: #f5e6c0; padding: 10px 18px; border-radius: 10px;
  font-size: 13px; z-index: 999; font-family: 'Cairo', sans-serif;
  box-shadow: 0 4px 20px rgba(0,0,0,0.5);
  animation: toastIn 0.3s ease;
  white-space: nowrap;
}
@keyframes toastIn { from{opacity:0;transform:translateX(-50%) translateY(10px)} to{opacity:1;transform:translateX(-50%) translateY(0)} }

audio { display: none; }

@media (max-width: 500px) {
  .ayat-text-area { font-size: 18px; padding: 10px 18px; }
  .page-header, .page-footer { padding-left: 18px; padding-right: 18px; }
  .logo span { display: none; }
}
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
  <div class="logo">
    Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø´Ø±ÙŠÙ
    <span>Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… ÙƒØ§Ù…Ù„Ø§Ù‹ Â· 604 ØµÙØ­Ø©</span>
  </div>

  <div class="nav-group">
    <!-- Surah selector -->
    <select class="sura-select" id="suraSelect" onchange="goToSura(this.value)">
      <option value="">â€” Ø§Ø®ØªØ± Ø³ÙˆØ±Ø© â€”</option>
    </select>

    <!-- Page navigation -->
    <div class="page-nav">
      <button class="nav-btn" onclick="changePage(1)" id="btnNext" title="Ø§Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©">â–¶</button>
      <div class="page-input-wrap">
        <input type="number" id="pageInput" min="1" max="604" value="1" onchange="goToPage(this.value)" onkeydown="if(event.key==='Enter')goToPage(this.value)">
        <span>/ 604</span>
      </div>
      <button class="nav-btn" onclick="changePage(-1)" id="btnPrev" title="Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©">â—€</button>
    </div>

    <!-- Audio upload -->
    <button class="topbar-btn" onclick="openUploadModal()">ğŸµ Ø±ÙØ¹ Ø§Ù„ØµÙˆØª</button>
  </div>
</div>

<!-- MUSHAF PAGE -->
<div class="mushaf-wrapper">
  <div class="mushaf-page" id="mushafPage">
    <div class="ayat-text-area" id="pageContent">
      <div class="skeleton-line" style="width:95%"></div>
      <div class="skeleton-line" style="width:88%"></div>
      <div class="skeleton-line" style="width:92%"></div>
      <div class="skeleton-line" style="width:85%"></div>
      <div class="skeleton-line" style="width:90%"></div>
    </div>
  </div>
</div>

<!-- PLAYER BAR -->
<div class="player-bar" id="playerBar">
  <div class="player-controls">
    <button class="pc-btn" onclick="prevAyah()" title="Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©">â®</button>
    <button class="pc-btn main-btn" id="playPauseBtn" onclick="togglePlay()">â–¶</button>
    <button class="pc-btn" onclick="nextAyah()" title="Ø§Ù„ØªØ§Ù„ÙŠØ©">â­</button>
  </div>
  <div class="player-info">
    <div class="player-title" id="playerTitle">â€”</div>
    <div class="player-sub" id="playerSub">â€”</div>
  </div>
  <div class="player-progress" id="playerProgress" onclick="seekAudio(event)">
    <div class="player-fill" id="playerFill"></div>
  </div>
  <button class="pc-btn" onclick="closePlayer()" style="font-size:14px">âœ•</button>
</div>

<!-- UPLOAD MODAL -->
<div class="upload-modal" id="uploadModal">
  <div class="modal-box">
    <div class="modal-title">ğŸµ Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø§Ù„ØµÙˆØª</div>
    <div class="modal-desc">
      Ø§Ø±ÙØ¹ Ù…Ù„ÙØ§Øª ØµÙˆØªÙŠØ© Ù„Ù„Ø¢ÙŠØ§Øª ÙˆØ³ØªØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª.<br>
      Ø³Ù…Ù‘ ÙƒÙ„ Ù…Ù„Ù Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø´ÙƒÙ„: <strong style="color:var(--gold2)">Ø±Ù‚Ù…_Ø§Ù„Ø³ÙˆØ±Ø©_Ø±Ù‚Ù…_Ø§Ù„Ø¢ÙŠØ©.mp3</strong><br>
      Ù…Ø«Ø§Ù„: <strong style="color:var(--gold2)">1_1.mp3</strong> Ù„Ù„ÙØ§ØªØ­Ø© Ø¢ÙŠØ© 1 Â· <strong style="color:var(--gold2)">2_255.mp3</strong> Ù„Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠ
    </div>
    <div class="uploaded-count" id="uploadedCount"></div>
    <input type="file" id="audioFileInput" multiple style="display:none" onchange="handleAudioUpload(event)">
    <div class="modal-drop" onclick="document.getElementById('audioFileInput').click()">
      <div class="drop-icon">ğŸ“</div>
      <div class="drop-text">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª<br><small style="color:#666">ÙŠØ¯Ø¹Ù…: mp3, m4a, ogg, wav</small></div>
    </div>
    <div class="modal-btns">
      <button class="modal-btn modal-btn-cancel" onclick="closeUploadModal()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>
</div>

<audio id="audioEl" ontimeupdate="onTimeUpdate()" onended="nextAyah()" onplay="onPlayEv()" onpause="onPauseEv()"></audio>

<script>
// ===================== SURA DATA =====================
const SURAS = [
  {n:1,name:"Ø§Ù„ÙØ§ØªØ­Ø©",ayat:7,page:1},{n:2,name:"Ø§Ù„Ø¨Ù‚Ø±Ø©",ayat:286,page:2},{n:3,name:"Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†",ayat:200,page:50},
  {n:4,name:"Ø§Ù„Ù†Ø³Ø§Ø¡",ayat:176,page:77},{n:5,name:"Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©",ayat:120,page:106},{n:6,name:"Ø§Ù„Ø£Ù†Ø¹Ø§Ù…",ayat:165,page:128},
  {n:7,name:"Ø§Ù„Ø£Ø¹Ø±Ø§Ù",ayat:206,page:151},{n:8,name:"Ø§Ù„Ø£Ù†ÙØ§Ù„",ayat:75,page:177},{n:9,name:"Ø§Ù„ØªÙˆØ¨Ø©",ayat:129,page:187},
  {n:10,name:"ÙŠÙˆÙ†Ø³",ayat:109,page:208},{n:11,name:"Ù‡ÙˆØ¯",ayat:123,page:221},{n:12,name:"ÙŠÙˆØ³Ù",ayat:111,page:235},
  {n:13,name:"Ø§Ù„Ø±Ø¹Ø¯",ayat:43,page:249},{n:14,name:"Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…",ayat:52,page:255},{n:15,name:"Ø§Ù„Ø­Ø¬Ø±",ayat:99,page:262},
  {n:16,name:"Ø§Ù„Ù†Ø­Ù„",ayat:128,page:267},{n:17,name:"Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡",ayat:111,page:282},{n:18,name:"Ø§Ù„ÙƒÙ‡Ù",ayat:110,page:293},
  {n:19,name:"Ù…Ø±ÙŠÙ…",ayat:98,page:305},{n:20,name:"Ø·Ù‡",ayat:135,page:312},{n:21,name:"Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡",ayat:112,page:322},
  {n:22,name:"Ø§Ù„Ø­Ø¬",ayat:78,page:332},{n:23,name:"Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†",ayat:118,page:342},{n:24,name:"Ø§Ù„Ù†ÙˆØ±",ayat:64,page:350},
  {n:25,name:"Ø§Ù„ÙØ±Ù‚Ø§Ù†",ayat:77,page:359},{n:26,name:"Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡",ayat:227,page:367},{n:27,name:"Ø§Ù„Ù†Ù…Ù„",ayat:93,page:377},
  {n:28,name:"Ø§Ù„Ù‚ØµØµ",ayat:88,page:385},{n:29,name:"Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª",ayat:69,page:396},{n:30,name:"Ø§Ù„Ø±ÙˆÙ…",ayat:60,page:404},
  {n:31,name:"Ù„Ù‚Ù…Ø§Ù†",ayat:34,page:411},{n:32,name:"Ø§Ù„Ø³Ø¬Ø¯Ø©",ayat:30,page:415},{n:33,name:"Ø§Ù„Ø£Ø­Ø²Ø§Ø¨",ayat:73,page:418},
  {n:34,name:"Ø³Ø¨Ø£",ayat:54,page:428},{n:35,name:"ÙØ§Ø·Ø±",ayat:45,page:434},{n:36,name:"ÙŠØ³",ayat:83,page:440},
  {n:37,name:"Ø§Ù„ØµØ§ÙØ§Øª",ayat:182,page:446},{n:38,name:"Øµ",ayat:88,page:453},{n:39,name:"Ø§Ù„Ø²Ù…Ø±",ayat:75,page:458},
  {n:40,name:"ØºØ§ÙØ±",ayat:85,page:467},{n:41,name:"ÙØµÙ„Øª",ayat:54,page:477},{n:42,name:"Ø§Ù„Ø´ÙˆØ±Ù‰",ayat:53,page:483},
  {n:43,name:"Ø§Ù„Ø²Ø®Ø±Ù",ayat:89,page:489},{n:44,name:"Ø§Ù„Ø¯Ø®Ø§Ù†",ayat:59,page:496},{n:45,name:"Ø§Ù„Ø¬Ø§Ø«ÙŠØ©",ayat:37,page:499},
  {n:46,name:"Ø§Ù„Ø£Ø­Ù‚Ø§Ù",ayat:35,page:502},{n:47,name:"Ù…Ø­Ù…Ø¯",ayat:38,page:507},{n:48,name:"Ø§Ù„ÙØªØ­",ayat:29,page:511},
  {n:49,name:"Ø§Ù„Ø­Ø¬Ø±Ø§Øª",ayat:18,page:515},{n:50,name:"Ù‚",ayat:45,page:518},{n:51,name:"Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª",ayat:60,page:520},
  {n:52,name:"Ø§Ù„Ø·ÙˆØ±",ayat:49,page:523},{n:53,name:"Ø§Ù„Ù†Ø¬Ù…",ayat:62,page:526},{n:54,name:"Ø§Ù„Ù‚Ù…Ø±",ayat:55,page:528},
  {n:55,name:"Ø§Ù„Ø±Ø­Ù…Ù†",ayat:78,page:531},{n:56,name:"Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©",ayat:96,page:534},{n:57,name:"Ø§Ù„Ø­Ø¯ÙŠØ¯",ayat:29,page:537},
  {n:58,name:"Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©",ayat:22,page:542},{n:59,name:"Ø§Ù„Ø­Ø´Ø±",ayat:24,page:545},{n:60,name:"Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©",ayat:13,page:549},
  {n:61,name:"Ø§Ù„ØµÙ",ayat:14,page:551},{n:62,name:"Ø§Ù„Ø¬Ù…Ø¹Ø©",ayat:11,page:553},{n:63,name:"Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†",ayat:11,page:554},
  {n:64,name:"Ø§Ù„ØªØºØ§Ø¨Ù†",ayat:18,page:556},{n:65,name:"Ø§Ù„Ø·Ù„Ø§Ù‚",ayat:12,page:558},{n:66,name:"Ø§Ù„ØªØ­Ø±ÙŠÙ…",ayat:12,page:560},
  {n:67,name:"Ø§Ù„Ù…Ù„Ùƒ",ayat:30,page:562},{n:68,name:"Ø§Ù„Ù‚Ù„Ù…",ayat:52,page:564},{n:69,name:"Ø§Ù„Ø­Ø§Ù‚Ø©",ayat:52,page:566},
  {n:70,name:"Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬",ayat:44,page:568},{n:71,name:"Ù†ÙˆØ­",ayat:28,page:570},{n:72,name:"Ø§Ù„Ø¬Ù†",ayat:28,page:572},
  {n:73,name:"Ø§Ù„Ù…Ø²Ù…Ù„",ayat:20,page:574},{n:74,name:"Ø§Ù„Ù…Ø¯Ø«Ø±",ayat:56,page:575},{n:75,name:"Ø§Ù„Ù‚ÙŠØ§Ù…Ø©",ayat:40,page:577},
  {n:76,name:"Ø§Ù„Ø¥Ù†Ø³Ø§Ù†",ayat:31,page:578},{n:77,name:"Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª",ayat:50,page:580},{n:78,name:"Ø§Ù„Ù†Ø¨Ø£",ayat:40,page:582},
  {n:79,name:"Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª",ayat:46,page:583},{n:80,name:"Ø¹Ø¨Ø³",ayat:42,page:585},{n:81,name:"Ø§Ù„ØªÙƒÙˆÙŠØ±",ayat:29,page:586},
  {n:82,name:"Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±",ayat:19,page:587},{n:83,name:"Ø§Ù„Ù…Ø·ÙÙÙŠÙ†",ayat:36,page:587},{n:84,name:"Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚",ayat:25,page:589},
  {n:85,name:"Ø§Ù„Ø¨Ø±ÙˆØ¬",ayat:22,page:590},{n:86,name:"Ø§Ù„Ø·Ø§Ø±Ù‚",ayat:17,page:591},{n:87,name:"Ø§Ù„Ø£Ø¹Ù„Ù‰",ayat:19,page:591},
  {n:88,name:"Ø§Ù„ØºØ§Ø´ÙŠØ©",ayat:26,page:592},{n:89,name:"Ø§Ù„ÙØ¬Ø±",ayat:30,page:593},{n:90,name:"Ø§Ù„Ø¨Ù„Ø¯",ayat:20,page:594},
  {n:91,name:"Ø§Ù„Ø´Ù…Ø³",ayat:15,page:595},{n:92,name:"Ø§Ù„Ù„ÙŠÙ„",ayat:21,page:595},{n:93,name:"Ø§Ù„Ø¶Ø­Ù‰",ayat:11,page:596},
  {n:94,name:"Ø§Ù„Ø´Ø±Ø­",ayat:8,page:596},{n:95,name:"Ø§Ù„ØªÙŠÙ†",ayat:8,page:597},{n:96,name:"Ø§Ù„Ø¹Ù„Ù‚",ayat:19,page:597},
  {n:97,name:"Ø§Ù„Ù‚Ø¯Ø±",ayat:5,page:598},{n:98,name:"Ø§Ù„Ø¨ÙŠÙ†Ø©",ayat:8,page:598},{n:99,name:"Ø§Ù„Ø²Ù„Ø²Ù„Ø©",ayat:8,page:599},
  {n:100,name:"Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª",ayat:11,page:599},{n:101,name:"Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©",ayat:11,page:600},{n:102,name:"Ø§Ù„ØªÙƒØ§Ø«Ø±",ayat:8,page:600},
  {n:103,name:"Ø§Ù„Ø¹ØµØ±",ayat:3,page:601},{n:104,name:"Ø§Ù„Ù‡Ù…Ø²Ø©",ayat:9,page:601},{n:105,name:"Ø§Ù„ÙÙŠÙ„",ayat:5,page:601},
  {n:106,name:"Ù‚Ø±ÙŠØ´",ayat:4,page:602},{n:107,name:"Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†",ayat:7,page:602},{n:108,name:"Ø§Ù„ÙƒÙˆØ«Ø±",ayat:3,page:602},
  {n:109,name:"Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†",ayat:6,page:603},{n:110,name:"Ø§Ù„Ù†ØµØ±",ayat:3,page:603},{n:111,name:"Ø§Ù„Ù…Ø³Ø¯",ayat:5,page:603},
  {n:112,name:"Ø§Ù„Ø¥Ø®Ù„Ø§Øµ",ayat:4,page:604},{n:113,name:"Ø§Ù„ÙÙ„Ù‚",ayat:5,page:604},{n:114,name:"Ø§Ù„Ù†Ø§Ø³",ayat:6,page:604}
];

// JUZ data (approximate start pages)
const JUZ = [1,21,41,61,81,101,121,141,161,181,201,221,241,261,281,301,321,341,361,381,401,421,441,461,481,501,521,541,561,581];

// ===================== STATE =====================
let currentPage = 1;
let pageAyahs = []; // ayahs on current page
let currentAyahIdx = -1; // index in pageAyahs
let localAudio = {}; // "sura_ayah" -> blob URL
let cache = {}; // page -> ayahs array

// ===================== INIT =====================
function init() {
  // Populate sura select
  const sel = document.getElementById('suraSelect');
  SURAS.forEach(s => {
    const o = document.createElement('option');
    o.value = s.page;
    o.textContent = `${s.n}. ${s.name}`;
    sel.appendChild(o);
  });
  // Keyboard navigation
  document.addEventListener('keydown', e => {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;
    if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
      // ÙÙŠ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©: Ø§Ù„Ø³Ù‡Ù… Ø§Ù„Ø£ÙŠÙ…Ù† = ØµÙØ­Ø© Ø³Ø§Ø¨Ù‚Ø©ØŒ Ø§Ù„Ø³Ù‡Ù… Ø§Ù„Ø£ÙŠØ³Ø± = ØµÙØ­Ø© ØªØ§Ù„ÙŠØ©
      changePage(e.key === 'ArrowRight' ? -1 : 1);
    }
  });
  loadPage(1);
}

// ===================== PAGE LOADING =====================
async function loadPage(p) {
  p = Math.max(1, Math.min(604, parseInt(p) || 1));
  currentPage = p;
  document.getElementById('pageInput').value = p;
  document.getElementById('btnPrev').disabled = p <= 1;
  document.getElementById('btnNext').disabled = p >= 604;

  // Update sura select
  let suraOnPage = SURAS.filter(s => s.page <= p).pop();
  if (suraOnPage) document.getElementById('suraSelect').value = suraOnPage.page;

  // Show skeleton
  const mushaf = document.getElementById('mushafPage');
  mushaf.classList.add('loading');

  if (cache[p]) {
    renderPage(p, cache[p]);
    mushaf.classList.remove('loading');
    return;
  }

  try {
    const res = await fetch(`https://api.alquran.cloud/v1/page/${p}/quran-uthmani`);
    if (!res.ok) throw new Error();
    const data = await res.json();
    const ayahs = data.data.ayahs;
    cache[p] = ayahs;
    renderPage(p, ayahs);
  } catch {
    // Fallback with error message
    document.getElementById('pageContent').innerHTML = `
      <div style="text-align:center;padding:60px 20px;color:#9e7a50;font-size:14px;font-family:Cairo,sans-serif">
        <div style="font-size:40px;margin-bottom:16px">âš ï¸</div>
        <p>ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ${p}</p>
        <p style="margin-top:8px;font-size:12px">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø«Ù… Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø© Ù…Ø¬Ø¯Ø¯Ø§Ù‹</p>
      </div>`;
    document.getElementById('mushafPage').innerHTML = '';
    mushaf.classList.remove('loading');
    return;
  }
  mushaf.classList.remove('loading');
}

function renderPage(p, ayahs) {
  pageAyahs = ayahs;
  currentAyahIdx = -1;

  // Determine which suras start on this page
  const surasOnPage = [];
  const seenSuras = new Set();
  ayahs.forEach(a => {
    if (!seenSuras.has(a.surah.number)) {
      seenSuras.add(a.surah.number);
      surasOnPage.push({ num: a.surah.number, name: a.surah.name, englishName: a.surah.englishName, revelation: a.surah.revelationType });
    }
  });

  // JUZ
  const juzNum = JUZ.findIndex((jp, i) => p >= jp && (i === JUZ.length-1 || p < JUZ[i+1])) + 1;

  let html = '';

  // Page header
  html += `<div class="page-header">
    <span class="page-meta">${surasOnPage.map(s=>s.name).join(' Â· ')}</span>
    <span class="page-num-display">${p}</span>
    <span class="juz-info">Ø§Ù„Ø¬Ø²Ø¡ ${juzNum}</span>
  </div>`;

  // Surah banners + basmala for new suras
  const firstAyah = ayahs[0];
  let prevSura = null;

  // Build content
  let contentHtml = '<div class="ayat-text-area">';

  ayahs.forEach((a, idx) => {
    // New sura header
    if (a.surah.number !== prevSura) {
      if (prevSura !== null) {
        contentHtml += `<div class="ornament-divider">ï´¾ Û ï´¿</div>`;
      }
      contentHtml += `
        <div class="sura-banner">
          <div class="sura-banner-name">${a.surah.name}</div>
          <div class="sura-banner-sub">${a.surah.englishName} Â· ${a.surah.revelationType === 'Meccan' ? 'Ù…ÙƒÙŠØ©' : 'Ù…Ø¯Ù†ÙŠØ©'} Â· ${a.surah.numberOfAyahs} Ø¢ÙŠØ©</div>
        </div>`;
      // Basmala (except Tawba)
      if (a.surah.number !== 9 && a.numberInSurah === 1) {
        contentHtml += `<div class="basmala-line">Ø¨ÙØ³Û¡Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Û¡Ù…ÙÙ€Ù°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>`;
      }
      prevSura = a.surah.number;
    }

    // Ayah text + number badge
    const hasLocalAudio = !!localAudio[`${a.surah.number}_${a.numberInSurah}`];
    const audioIndicator = hasLocalAudio ? '<span style="color:#4caf72;font-size:10px">â—</span>' : '';
    contentHtml += `<span class="ayah-inline" id="ayah-${idx}" onclick="playAyah(${idx})" title="Ø¢ÙŠØ© ${a.numberInSurah} - Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø¹">${a.text} </span><span class="ayah-number-badge" id="badge-${idx}" onclick="playAyah(${idx})">${toArabicNum(a.numberInSurah)}</span>${audioIndicator} `;
  });

  contentHtml += '</div>';
  html += contentHtml;

  // Footer
  html += `<div class="page-footer">
    <span class="footer-dots">Â· Â· Â·</span>
    <span class="page-footer-num">${p}</span>
    <span class="footer-dots">Â· Â· Â·</span>
  </div>`;

  document.getElementById('mushafPage').innerHTML = html;
}

function toArabicNum(n) {
  return String(n).replace(/\d/g, d => 'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'[d]);
}

// ===================== NAVIGATION =====================
function changePage(dir) {
  loadPage(currentPage + dir);
}
function goToPage(val) {
  loadPage(val);
}
function goToSura(page) {
  if (page) loadPage(page);
}

// ===================== AUDIO PLAYBACK =====================
function playAyah(idx) {
  if (!pageAyahs.length || idx < 0 || idx >= pageAyahs.length) return;
  const a = pageAyahs[idx];
  const key = `${a.surah.number}_${a.numberInSurah}`;
  const audio = document.getElementById('audioEl');

  // Clear previous highlights
  document.querySelectorAll('.ayah-inline.playing').forEach(el => el.classList.remove('playing'));
  document.querySelectorAll('.ayah-number-badge.playing').forEach(el => el.classList.remove('playing'));

  currentAyahIdx = idx;

  const localSrc = localAudio[key];
  const onlineSrc = `https://cdn.islamic.network/quran/audio/128/ar.alafasy/${a.number}.mp3`;

  audio.src = localSrc || onlineSrc;
  audio.play().then(() => {
    highlightAyah(idx);
    showPlayer(a);
  }).catch(() => {
    showToast('âš ï¸ ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª. Ø§Ø±ÙØ¹ Ù…Ù„ÙØ§Ù‹ Ø£Ùˆ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„');
  });
}

function highlightAyah(idx) {
  const el = document.getElementById(`ayah-${idx}`);
  const badge = document.getElementById(`badge-${idx}`);
  if (el) { el.classList.add('playing'); el.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
  if (badge) badge.classList.add('playing');
}

function showPlayer(a) {
  document.getElementById('playerBar').classList.add('visible');
  document.getElementById('playerTitle').textContent = `${a.surah.name} - Ø§Ù„Ø¢ÙŠØ© ${a.numberInSurah}`;
  document.getElementById('playerSub').textContent = a.text.substring(0, 60) + '...';
  document.getElementById('playPauseBtn').textContent = 'â¸';
}

function togglePlay() {
  const a = document.getElementById('audioEl');
  a.paused ? a.play() : a.pause();
}

function onPlayEv() {
  document.getElementById('playPauseBtn').textContent = 'â¸';
  highlightAyah(currentAyahIdx);
}
function onPauseEv() {
  document.getElementById('playPauseBtn').textContent = 'â–¶';
}

function nextAyah() {
  if (currentAyahIdx < pageAyahs.length - 1) {
    playAyah(currentAyahIdx + 1);
  } else if (currentPage < 604) {
    loadPage(currentPage + 1).then ? loadPage(currentPage + 1) : null;
    // After load, play first ayah
    setTimeout(() => playAyah(0), 1800);
  }
}
function prevAyah() {
  if (currentAyahIdx > 0) playAyah(currentAyahIdx - 1);
}

function onTimeUpdate() {
  const a = document.getElementById('audioEl');
  if (a.duration) document.getElementById('playerFill').style.width = (a.currentTime / a.duration * 100) + '%';
}
function seekAudio(e) {
  const a = document.getElementById('audioEl');
  const bar = document.getElementById('playerProgress');
  a.currentTime = (e.offsetX / bar.offsetWidth) * a.duration;
}
function closePlayer() {
  document.getElementById('audioEl').pause();
  document.getElementById('playerBar').classList.remove('visible');
  document.querySelectorAll('.ayah-inline.playing').forEach(el => el.classList.remove('playing'));
  document.querySelectorAll('.ayah-number-badge.playing').forEach(el => el.classList.remove('playing'));
}

// ===================== AUDIO UPLOAD =====================
function openUploadModal() { 
  document.getElementById('uploadModal').classList.add('open'); 
}
function closeUploadModal() { 
  document.getElementById('uploadModal').classList.remove('open'); 
}

function handleAudioUpload(e) {
  processFiles(Array.from(e.target.files));
  // Reset input so same files can be re-uploaded
  e.target.value = '';
}

function processFiles(files) {
  let count = 0;
  files.forEach(f => {
    // Expected: sura_ayah.mp3 or sura-ayah.mp3
    const m = f.name.match(/^(\d+)[_\-](\d+)/);
    if (m) {
      const key = `${m[1]}_${m[2]}`;
      if (localAudio[key]) URL.revokeObjectURL(localAudio[key]);
      localAudio[key] = URL.createObjectURL(f);
      count++;
    }
  });
  const msg = count > 0 
    ? `âœ… ØªÙ… Ø±ÙØ¹ ${count} Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­` 
    : 'âš ï¸ ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ù…ÙŠØ© Ø§Ù„Ù…Ù„ÙØ§Øª: Ø³ÙˆØ±Ø©_Ø¢ÙŠØ©.mp3 (Ù…Ø«Ø§Ù„: 1_1.mp3)';
  document.getElementById('uploadedCount').textContent = msg;
  // Re-render page to show audio indicators
  if (cache[currentPage]) renderPage(currentPage, cache[currentPage]);
}

// Drag & drop
document.addEventListener('DOMContentLoaded', () => {
  const drop = document.querySelector('.modal-drop');
  if (!drop) return;
  drop.addEventListener('dragover', e => { e.preventDefault(); drop.style.borderColor = 'var(--gold)'; });
  drop.addEventListener('dragleave', () => { drop.style.borderColor = ''; });
  drop.addEventListener('drop', e => {
    e.preventDefault();
    drop.style.borderColor = '';
    processFiles(Array.from(e.dataTransfer.files));
  });
});

// ===================== TOAST =====================
function showToast(msg) {
  const t = document.createElement('div');
  t.className = 'toast';
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(() => t.remove(), 3000);
}

// ===================== SWIPE (MOBILE) =====================
let touchStartX = 0;
document.addEventListener('touchstart', e => touchStartX = e.touches[0].clientX, { passive: true });
document.addEventListener('touchend', e => {
  const diff = touchStartX - e.changedTouches[0].clientX;
  // Ø³Ø­Ø¨ Ù„Ù„ÙŠØ³Ø§Ø± = ØµÙØ­Ø© ØªØ§Ù„ÙŠØ©ØŒ Ø³Ø­Ø¨ Ù„Ù„ÙŠÙ…ÙŠÙ† = ØµÙØ­Ø© Ø³Ø§Ø¨Ù‚Ø©
  if (Math.abs(diff) > 60) changePage(diff > 0 ? -1 : 1);
}, { passive: true });

init();
</script>
</body>
</html>
